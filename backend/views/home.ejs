<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MenStyle - Trang ch·ªß</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body { font-family: 'Segoe UI', sans-serif; background:#f0f2f5; margin:0; padding:0; display:flex; }
    .sidebar.collapsed a span{display:none;}
    .sidebar{ width:240px; min-height:100vh; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,.05); padding:20px 0; transition:.3s; }
    .sidebar.collapsed{ width:60px; }
    .sidebar a{ display:flex; align-items:center; gap:10px; padding:10px 20px; color:#333; text-decoration:none; font-weight:500; transition:.3s; white-space:nowrap; }
    .sidebar a:hover{ background:#111; color:#fff; }
    .sidebar a i{ font-size:20px; }
    .content{ flex:1; padding:30px; }
    header{ background:#111; color:#fff; padding:15px 20px; font-size:24px; font-weight:600; display:flex; align-items:center; gap:15px; margin-bottom:30px; border-radius:8px; }
    .dashboard-title{ font-size:28px; font-weight:700; margin:15px 0 6px; }
    .card-box{ background:#fff; padding:22px; border-radius:14px; box-shadow:0 6px 18px rgba(0,0,0,.06); text-align:center; transition:.25s; }
    .card-box:hover{ transform:translateY(-4px); box-shadow:0 12px 24px rgba(0,0,0,.1); }
    .icon-box{ width:64px; height:64px; margin:0 auto 14px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:28px; color:#fff; }
    .text-muted-small{ font-size:14px; color:#889; }
    .sidebar a.active {
      background-color: #000 !important; /* n·ªÅn ƒëen */
      color: #fff !important;            /* ch·ªØ tr·∫Øng */
    }
    .sidebar a.active i {
      color: #fff !important;            /* icon tr·∫Øng */
    }
    /* Notification Styles */
    .notification-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5); /* Semi-transparent backdrop */
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none; /* Prevent interaction with backdrop */
    }
    .notification-container.show {
      opacity: 1;
    }
    .notification {
      background: #fff;
      padding: 20px 30px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
      max-width: 500px;
      width: 90%;
      transform: scale(0.8);
      transition: transform 0.3s ease;
    }
    .notification-container.show .notification {
      transform: scale(1);
    }
    .notification.success {
      background-color: #e7f3fe;
      border: 2px solid #b6d4fe;
      color: #084298;
    }
    .notification.info {
      background-color: #f8f9fa;
      border: 2px solid #d3d6d8;
      color: #41464b;
    }
    .notification i {
      font-size: 1.5rem;
    }
    .notification span {
      font-size: 1.2rem;
      font-weight: 500;
    }
    .notification strong {
      font-weight: 700;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
    <a href="/admin/home" class="active"><i class="bi bi-house"></i><span>Trang ch·ªß</span></a>
    <a href="/order/by-date"><i class="bi bi-bell"></i><span>Th√¥ng b√°o</span></a>
    <a href="/products/view"><i class="bi bi-box"></i><span>S·∫£n ph·∫©m</span></a>
    <a href="/products/product-types/view"><i class="bi bi-tags"></i><span>Th·ªÉ lo·∫°i</span></a>
    <a href="/voucher/view"><i class="bi bi-ticket"></i><span>Phi·∫øu gi·∫£m gi√°</span></a>
    <a href="/accounts/view"><i class="bi bi-people"></i><span>T√†i kho·∫£n</span></a>
    <a href="/accounts/admin/orders"><i class="bi bi-receipt-cutoff"></i><span>ƒê∆°n h√†ng</span></a>
    <a href="/dashboard/stats-overview"><i class="bi bi-bar-chart-line"></i><span>Th·ªëng k√™</span></a>
    <a href="/setting/view"><i class="bi bi-gear"></i><span>C√†i ƒë·∫∑t</span></a>
  </nav>

  <!-- Content -->
  <div class="content" id="content">
    <header>
      <button id="toggleBtn" class="btn btn-dark"><i class="bi bi-list"></i></button>
      MenStyle - Trang ch·ªß
    </header>

    <!-- Slider / Banner -->
    <% const _banners = (typeof banners !== 'undefined' && Array.isArray(banners)) ? banners : []; %>
    <% if (_banners.length) { %>
      <div id="bannerCarousel" class="carousel slide mb-4" data-bs-ride="carousel" style="max-width:1100px; margin:0 auto;">
        <div class="carousel-inner" style="height:400px; border-radius:12px; overflow:hidden;">
          <% _banners.forEach((banner, index) => {
               const img = banner?.image || '';
               const isHttp = /^https?:\/\//.test(img);
               const isAbsolute = img.startsWith('/');
               const src = isHttp ? img : (isAbsolute ? img : ('/banners/' + img)); %>
            <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
              <img src="<%= src %>" class="d-block w-100" alt="Banner <%= index + 1 %>" style="width:100%; height:100%; object-fit:cover;">
            </div>
          <% }) %>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Tr∆∞·ªõc</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Sau</span>
        </button>
        <div class="carousel-indicators" style="margin-bottom:-25px;">
          <% _banners.forEach((_, i) => { %>
            <button type="button" data-bs-target="#bannerCarousel" data-bs-slide-to="<%= i %>" class="<%= i === 0 ? 'active' : '' %>"></button>
          <% }) %>
        </div>
      </div>
    <% } %>

    <!-- Dashboard -->
    <main>
      <div class="dashboard-title">T·ªïng quan h·ªá th·ªëng</div>
      <p class="text-muted">Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi b·∫£ng ƒëi·ªÅu khi·ªÉn. D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë th·ªëng k√™ nhanh.</p>

      <div class="row g-3">
        <div class="col-md-6 col-lg-3">
          <div class="card-box text-center">
            <div class="icon-box bg-info mx-auto"><i class="bi bi-graph-up"></i></div>
            <h6 class="mt-2">Doanh Thu H√¥m Nay</h6>
            <h4 class="text-info fw-bold"><%= (typeof todayRevenue !== 'undefined' ? Number(todayRevenue) : 0).toLocaleString('vi-VN') %> VNƒê</h4>
            <div class="text-muted text-muted-small">T·ªïng doanh thu trong ng√†y</div>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="card-box text-center">
            <div class="icon-box bg-warning mx-auto"><i class="bi bi-cart-check"></i></div>
            <h6 class="mt-2">ƒê∆°n H√†ng H√¥m Nay</h6>
            <h4 class="text-warning fw-bold"><%= (typeof todayOrderCount !== 'undefined' ? todayOrderCount : 0) %></h4>
            <div class="text-muted text-muted-small">T·ªïng s·ªë ƒë∆°n trong ng√†y</div>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="card-box text-center">
            <div class="icon-box bg-primary mx-auto"><i class="bi bi-hourglass-split"></i></div>
            <h6 class="mt-2">ƒê∆°n H√†ng Ch·ªù X·ª≠ L√Ω</h6>
            <h4 class="text-primary fw-bold"><%= pendingOrderCount || 0 %></h4>
            <div class="text-muted text-muted-small">T·ªïng s·ªë ƒë∆°n ch∆∞a x·ª≠ l√Ω</div>
          </div>
        </div>
        <div class="col-md-6 col-lg-3">
          <div class="card-box text-center">
            <div class="icon-box bg-success mx-auto"><i class="bi bi-person-circle"></i></div>
            <h6 class="mt-2">T·ªïng Ng∆∞·ªùi D√πng</h6>
            <h4 class="text-success fw-bold"><%= userCount || 0 %></h4>
            <div class="text-muted text-muted-small"><%= userCount || 0 %> t√†i kho·∫£n ƒë√£ t·∫°o</div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Sidebar toggle
    const toggleBtn = document.getElementById('toggleBtn');
    const sidebar = document.getElementById('sidebar');
    toggleBtn.addEventListener('click', () => sidebar.classList.toggle('collapsed'));

    // Notification logic
    function showNotification() {
      // Ensure todayOrderCount is defined (from EJS)
      const orderCount = <%= typeof todayOrderCount !== 'undefined' ? todayOrderCount : 0 %>;

      // Create notification container and element
      const container = document.createElement('div');
      container.className = 'notification-container';
      const notification = document.createElement('div');
      notification.className = 'notification';

      // Determine notification type and content
      if (orderCount > 0) {
        notification.classList.add('success');
        notification.innerHTML = `
          <i class="bi bi-bell-fill text-primary"></i>
          <span>H√¥m nay c√≥ <strong>${orderCount}</strong> ƒë∆°n h√†ng m·ªõi üéâ</span>
        `;
      } else {
        notification.classList.add('info');
        notification.innerHTML = `
          <i class="bi bi-info-circle text-muted"></i>
          <span>H√¥m nay ch∆∞a c√≥ ƒë∆°n h√†ng m·ªõi.</span>
        `;
      }

      // Append notification to container and container to body
      container.appendChild(notification);
      document.body.appendChild(container);

      // Show notification
      setTimeout(() => {
        container.classList.add('show');
      }, 100);

      // Remove notification after 3 seconds
      setTimeout(() => {
        container.classList.remove('show');
        setTimeout(() => {
          container.remove();
        }, 300);
      }, 3000);
    }

    // Check for successful login and trigger notification
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('login') === 'success') {
      window.onload = showNotification;
      // Clean up URL to remove query parameter
      window.history.replaceState({}, document.title, '/admin/home');
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>