<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>MenStyle - Trang chủ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body { font-family: 'Segoe UI', sans-serif; background:#f5f6f8; margin:0; padding:0; display:flex; }
    .sidebar.collapsed a span{display:none;}
    .sidebar{ width:240px; min-height:100vh; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,.05); padding:20px 0; transition:.3s; }
    .sidebar.collapsed{ width:60px; }
    .sidebar a{ display:flex; align-items:center; gap:10px; padding:10px 20px; color:#333; text-decoration:none; font-weight:500; transition:.3s; white-space:nowrap; }
    .sidebar a:hover{ background:#111; color:#fff; }
    .sidebar a i{ font-size:20px; }
    .content{ flex:1; padding:30px; }
    header{ background:#111; color:#fff; padding:15px 20px; font-size:24px; font-weight:600; display:flex; align-items:center; gap:15px; margin-bottom:30px; border-radius:8px; }
    .dashboard-title{ font-size:28px; font-weight:700; margin:15px 0 6px; }
    .card-box{ background:#fff; padding:22px; border-radius:14px; box-shadow:0 6px 18px rgba(0,0,0,.06); text-align:center; transition:.25s; }
    .card-box:hover{ transform:translateY(-4px); box-shadow:0 12px 24px rgba(0,0,0,.1); }
    .icon-box{ width:64px; height:64px; margin:0 auto 14px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:28px; color:#fff; }
    .text-muted-small{ font-size:14px; color:#889; }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
    <a href="/"><i class="bi bi-house"></i><span>Trang chủ</span></a>
    <a href="/products/view"><i class="bi bi-box"></i><span> Sản phẩm</span></a>
    <a href="/products/product-types/view"><i class="bi bi-tags"></i><span> Thể loại</span></a>
    <a href="/voucher/view"><i class="bi bi-ticket"></i><span> Phiếu giảm giá</span></a>
    <a href="/accounts/view"><i class="bi bi-people"></i><span> Tài khoản</span></a>
    <a href="/accounts/admin/orders"><i class="bi bi-receipt-cutoff"></i><span> Đơn hàng</span></a>
    <a href="/dashboard/stats-overview"><i class="bi bi-bar-chart-line"></i><span> Thống kê</span></a>
    <a href="/setting/view"><i class="bi bi-gear"></i><span>Cài đặt</span></a>
  </nav>

  <!-- Content -->
  <div class="content" id="content">
    <header>
      <button id="toggleBtn" class="btn btn-dark"><i class="bi bi-list"></i></button>
      MenStyle - Trang chủ
    </header>

    <!-- Slider / Banner -->
    <% const _banners = (typeof banners !== 'undefined' && Array.isArray(banners)) ? banners : []; %>
    <% if (_banners.length) { %>
      <div id="bannerCarousel" class="carousel slide mb-4" data-bs-ride="carousel" style="max-width:1100px; margin:0 auto;">
        <div class="carousel-inner" style="height:400px; border-radius:12px; overflow:hidden;">
          <% _banners.forEach((banner, index) => {
               const img = banner?.image || '';
               const isHttp = /^https?:\/\//.test(img);
               const isAbsolute = img.startsWith('/');
               const src = isHttp ? img : (isAbsolute ? img : ('/banners/' + img)); %>
            <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
              <img src="<%= src %>" class="d-block w-100" alt="Banner <%= index + 1 %>" style="width:100%; height:100%; object-fit:cover;">
            </div>
          <% }) %>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Trước</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Sau</span>
        </button>
        <div class="carousel-indicators" style="margin-bottom:-25px;">
          <% _banners.forEach((_, i) => { %>
            <button type="button" data-bs-target="#bannerCarousel" data-bs-slide-to="<%= i %>" class="<%= i === 0 ? 'active' : '' %>"></button>
          <% }) %>
        </div>
      </div>
    <% } %>

    <!-- Dashboard -->
    <main>
      <div class="dashboard-title">Tổng quan hệ thống</div>
      <p class="text-muted">Chào mừng bạn đến với bảng điều khiển. Dưới đây là một số thống kê nhanh.</p>

      <div class="row g-3">
        <!-- 1) Doanh thu hôm nay -->
        <div class="col-md-6 col-lg-3">
          <div class="card-box text-center">
            <div class="icon-box bg-info mx-auto"><i class="bi bi-graph-up"></i></div>
            <h6 class="mt-2">Doanh Thu Hôm Nay</h6>
            <h4 class="text-info fw-bold"><%= (typeof todayRevenue !== 'undefined' ? Number(todayRevenue) : 0).toLocaleString('vi-VN') %> VNĐ</h4>
            <div class="text-muted text-muted-small">Tổng doanh thu trong ngày</div>
          </div>
        </div>

        <!-- 2) Đơn hàng hôm nay -->
        <div class="col-md-6 col-lg-3">
          <div class="card-box text-center">
            <div class="icon-box bg-warning mx-auto"><i class="bi bi-cart-check"></i></div>
            <h6 class="mt-2">Đơn Hàng Hôm Nay</h6>
            <h4 class="text-warning fw-bold"><%= (typeof todayOrderCount !== 'undefined' ? todayOrderCount : 0) %></h4>
            <div class="text-muted text-muted-small">Tổng số đơn trong ngày</div>
          </div>
        </div>

        <!-- 3) Đơn hàng chờ xử lý -->
        <div class="col-md-6 col-lg-3">
          <div class="card-box text-center">
            <div class="icon-box bg-primary mx-auto"><i class="bi bi-hourglass-split"></i></div>
            <h6 class="mt-2">Đơn Hàng Chờ Xử Lý</h6>
            <h4 class="text-primary fw-bold"><%= pendingOrderCount || 0 %></h4>
            <div class="text-muted text-muted-small">Tổng số đơn chưa xử lý</div>
          </div>
        </div>

        <!-- 4) Tổng người dùng -->
        <div class="col-md-6 col-lg-3">
          <div class="card-box text-center">
            <div class="icon-box bg-success mx-auto"><i class="bi bi-person-circle"></i></div>
            <h6 class="mt-2">Tổng Người Dùng</h6>
            <h4 class="text-success fw-bold"><%= userCount || 0 %></h4>
            <div class="text-muted text-muted-small"><%= userCount || 0 %> tài khoản đã tạo</div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    const toggleBtn = document.getElementById('toggleBtn');
    const sidebar = document.getElementById('sidebar');
    toggleBtn.addEventListener('click', () => sidebar.classList.toggle('collapsed'));
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
