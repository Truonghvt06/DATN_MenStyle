<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <title>MenStyle - Chi tiết người dùng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 240px;
      height: 100vh;
      background: #fff;
      padding: 30px 20px;
      box-shadow: 2px 0 6px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      gap: 16px;
      position: fixed;
      top: 0;
      left: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .sidebar a {
      text-decoration: none;
      color: #333;
      font-weight: 500;
      padding: 10px 15px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: 0.3s;
    }

    .sidebar a:hover {
      background: #111;
      color: #fff;
    }

    .content {
      margin-left: 240px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    header {
      background-color: #111;
      color: #fff;
      padding: 15px 20px;
      font-size: 22px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    main {
      padding: 30px;
      flex: 1;
    }

    .card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .info-item {
      margin-bottom: 10px;
      color: #555;
    }

    .info-item strong {
      color: #333;
    }

    .table th,
    .table td {
      vertical-align: middle;
      text-align: left;
      padding: 8px;
    }

    .table th {
      font-weight: 600;
      color: #333;
    }

    .table td {
      color: #555;
    }

    .avatar-img {
      max-width: 120px;
      border-radius: 8px;
    }
    .sidebar a.active {
  background-color: #000 !important; /* nền đen */
  color: #fff !important;            /* chữ trắng */
}
.sidebar a.active i {
  color: #fff !important;            /* icon trắng */
}

  </style>
</head>

<body>
  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
    <a href="/"><i class="bi bi-house"></i><span>Trang chủ</span></a>
    <a href="/order/by-date"><i class="bi bi-bell"></i><span>Thông báo</span></a>
    <a href="/products/view"><i class="bi bi-box"></i><span> Sản phẩm</span></a>
    <a href="/products/product-types/view"><i class="bi bi-tags"></i><span> Thể loại</span></a>
    <a href="/voucher/view"><i class="bi bi-ticket"></i><span> Phiếu giảm giá</span></a>
    <a href="/accounts/view" class="active"><i class="bi bi-people"></i><span> Tài khoản</span></a>
    <a href="/accounts/admin/orders"><i class="bi bi-receipt-cutoff"></i><span> Đơn hàng</span></a>
    <a href="/dashboard/stats-overview"><i class="bi bi-bar-chart-line"></i><span> Thống kê</span></a>
    <a href="/setting/view"><i class="bi bi-gear"></i> <span>Cài đặt</span></a>
  </nav>

  <!-- Content -->
  <div class="content">
    <header>MenStyle - Chi tiết người dùng</header>
    <main>
      <!-- Thông tin người dùng -->
      <div class="card">
        <div class="card-title"><i class="bi bi-person-circle"></i> Thông tin người dùng</div>
        <div class="row">
          <div class="col-md-6">
            <div class="info-item"><strong>Tên:</strong>
              <%= user.name %>
            </div>
            <div class="info-item"><strong>Email:</strong>
              <%= user.email %>
            </div>
            <div class="info-item"><strong>SĐT:</strong>
              <%= user.phone %>
            </div>
            <div class="info-item"><strong>Giới tính:</strong>
              <%= user.gender || 'Chưa cung cấp' %>
            </div>
            <div class="info-item"><strong>Ngày sinh:</strong>
              <%= user.date_of_birth || 'Chưa cung cấp' %>
            </div>
            <div class="info-item"><strong>Cập nhật:</strong>
              <%= new Date(user.updatedAt).toLocaleDateString('vi-VN') %>
            </div>

          </div>
          <div class="col-md-6 text-center">
            <% if (user.avatar) { %>
              <img src="<%= user.avatar %>" alt="Avatar" class="avatar-img" />
              <% } else { %>
                <p class="text-muted">Không có ảnh đại diện</p>
                <% } %>
          </div>
        </div>
      </div>

      <!-- Giỏ hàng -->
      <div class="card mt-4">
        <div class="card-title">
          <i class="bi bi-cart-fill"></i> Giỏ hàng (<%= user.cart.length %>
            sản phẩm)
        </div>
        <% if (user.cart.length> 0) { let totalPrice = 0; %>
          <table class="table table-bordered align-middle">
            <thead class="table-light">
              <tr>
                <th>Hình ảnh</th>
                <th>Sản phẩm</th>
                <th>Màu / Size</th>
                <th>Số lượng</th>
                <th>Đơn giá</th>
                <th>Thành tiền</th>
              </tr>
            </thead>
            <tbody>
              <% user.cart.forEach((item, index)=> { const variant =
                item.productId?.variants?.[item.variantIndex]; const price =
                item.productId?.price || 0; const subtotal = price *
                item.quantity; totalPrice += subtotal; %>
                <tr>
                  <td>
                    <% if (variant?.image) { %>
                      <img src="<%= variant.image %>" style="max-width: 60px" />
                      <% } else { %> Không có ảnh <% } %>
                  </td>
                  <td>
                    <%= item.productId?.name || 'Không rõ' %>
                  </td>
                  <td>
                    <%= (variant?.color || '-' ) + ' / ' + (variant?.size || '-' ) %>
                  </td>
                  <td style="width: 160px">
                    <div class="input-group">
                      <input type="text" class="form-control text-center" value="<%= item.quantity %>" readonly />
                    </div>
                  </td>
                  <td>
                    <%= price.toLocaleString('vi-VN') %> ₫
                  </td>
                  <td>
                    <%= subtotal.toLocaleString('vi-VN') %> ₫
                  </td>
                </tr>
                <% }) %>
            </tbody>
            <tfoot>
              <tr>
                <td colspan="5" class="text-end">
                  <strong>Tổng cộng:</strong>
                </td>
                <td>
                  <strong>
                    <%= totalPrice.toLocaleString('vi-VN') %> ₫
                  </strong>
                </td>
              </tr>
            </tfoot>
          </table>
          <% } else { %>
            <p class="text-muted">Giỏ hàng trống</p>
            <% } %>



      </div>
      <div class="card mt-4">
        <div class="card-title">
          <i class="bi bi-receipt"></i> Đơn hàng đã đặt
        </div>
      <% if (orders.length> 0) { %>
        <table class="table table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th>Mã đơn</th>
              <th>Tổng tiền</th>
              <th>Trạng thái</th>
              <th>Thanh toán</th>
              <th>Ngày đặt</th>
              <th>Sản phẩm</th>
            </tr>
          </thead>
          <tbody>
            <% orders.forEach(order=> { %>
              <tr>
                <td>
                  <a href="/order/order_detail/<%= order._id %>" class="order-code text-decoration-none">
                        #<%= order.code %>
                      </a>
                </td>
                <td>
                  <%= order.total_amount.toLocaleString() %> VNĐ
                </td>
                <td>
                  <span class="badge 
                    <%= order.order_status === 'pending' ? 'bg-warning text-dark' : 
                        order.order_status === 'confirmed' ? 'bg-info text-dark' :
                        order.order_status === 'shipping' ? 'bg-primary' :
                        order.order_status === 'delivered' ? 'bg-success' : 
                        'bg-danger' %>">
                    <%= order.order_status === 'pending' ? 'Chờ xác nhận' : 
                        order.order_status === 'confirmed' ? 'Đã xác nhận' : 
                        order.order_status === 'shipping' ? 'Đang giao' : 
                        order.order_status === 'delivered' ? 'Đã giao' : 
                        'Đã huỷ' %>
                </span>
                </td>
                <td>
                  <span class="badge 
                    <%= order.payment_status === 'unpaid' ? 'bg-warning text-dark' : 
                        order.payment_status === 'paid' ? 'bg-success' : 
                        'bg-secondary' %>">
                    <%= order.payment_status === 'unpaid' ? 'Chưa thanh toán' : 
                        order.payment_status === 'paid' ? 'Đã thanh toán' : 
                        'Hoàn tiền' %>
                </span>
                </td>
                <td>
                  <%= new Date(order.createdAt).toLocaleString() %>
                </td>
                <td>
                  <ul class="list-unstyled">
                    <% order.items.forEach(item=> { %>
                      <li>
                        <%= item.product_id ? item.product_id.name : 'SP đã xóa' %>
                          - SL: <%= item.quantity %>
                            - Giá: <%= item.price.toLocaleString() %> VNĐ
                      </li>
                      <% }) %>
                  </ul>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
        <% } else { %>
          <p class="text-muted">Người dùng chưa có đơn hàng nào.</p>
          <% } %>



      </div>
    

    </main>
  </div>


  <script>
    const allProductsMap = {
        <% products.forEach(p => { %>
      "<%= p._id %>": <% - JSON.stringify(p.variants || []) %>,
        <% }) %>
      };

    function loadVariants(productId) {
      const variants = allProductsMap[productId] || [];
      const variantList = document.getElementById("variantList");
      variantList.innerHTML = "";
      variants.forEach((v, i) => {
        variantList.innerHTML += `
            <label class="d-block border p-2 rounded mb-2">
              <input type="radio" name="variantIndex" value="${i}" required />
              Size: ${v.size || '-'}, Màu: ${v.color || '-'}, SL: ${v.quantity || 0}
            </label>
          `;
      });
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>